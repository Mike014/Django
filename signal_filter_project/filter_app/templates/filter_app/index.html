<!DOCTYPE html>
<html>
<head>
    <title>Low-Pass Filter</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
    <h1>Low-Pass Filter</h1>
    <form method="get" action="{% url 'filter_app:index' %}">
        <label for="frequency">Signal Frequency:</label>
        <input type="range" id="frequency" name="frequency" min="40" max="17000" value="{{ frequency }}" oninput="updateFrequency(this.value)">
        <span id="frequencyValue">{{ frequency }}</span> Hz
        <br>
        <label for="cutoff">Cut-Off Frequency:</label>
        <input type="range" id="cutoff" name="cutoff" min="40" max="17000" value="{{ cutoff }}" oninput="updateCutoff(this.value)">
        <span id="cutoffValue">{{ cutoff }}</span> Hz
        <br>
        <label for="resonance">Resonance:</label>
        <input type="range" id="resonance" name="resonance" min="0.1" max="1.414" step="0.01" value="{{ resonance }}" oninput="updateResonance(this.value)">
        <span id="resonanceValue">{{ resonance }}</span>
        <br>
        <button type="submit">Apply</button>
    </form>

    <button onclick="playSound()">Play</button>

    <div id="originalSignal" style="width:800px;height:400px;"></div>
    <div id="filteredSignal" style="width:800px;height:400px;"></div>

    <script>
        const t = JSON.parse('{{ t|escapejs }}');
        const signal = JSON.parse('{{ signal|escapejs }}');
        const filteredSignal = JSON.parse('{{ filtered_signal|escapejs }}');

        console.log("Time Array:", t);
        console.log("Original Signal:", signal);
        console.log("Filtered Signal:", filteredSignal);

        Plotly.newPlot('originalSignal', [{
            x: t,
            y: signal,
            type: 'scatter',
            mode: 'lines',
            name: 'Original Signal',
            line: { color: 'blue' }
        }], {
            title: 'Original Signal',
            xaxis: { title: 'Time [s]' },
            yaxis: { title: 'Amplitude' }
        });

        Plotly.newPlot('filteredSignal', [{
            x: t,
            y: filteredSignal,
            type: 'scatter',
            mode: 'lines',
            name: 'Filtered Signal',
            line: { color: 'red' }
        }], {
            title: 'Filtered Signal',
            xaxis: { title: 'Time [s]' },
            yaxis: { title: 'Amplitude' }
        });

        function updateFrequency(value) {
            document.getElementById('frequencyValue').innerText = value;
        }

        function updateCutoff(value) {
            document.getElementById('cutoffValue').innerText = value;
        }

        function updateResonance(value) {
            document.getElementById('resonanceValue').innerText = value;
        }

        function playSound() {
            console.log("Playing sound...");
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const buffer = audioContext.createBuffer(1, filteredSignal.length, 44100);
            const data = buffer.getChannelData(0);
            for (let i = 0; i < filteredSignal.length; i++) {
                data[i] = filteredSignal[i];
            }

            const source = audioContext.createBufferSource();
            source.buffer = buffer;
            source.connect(audioContext.destination);
            source.start();
        }
    </script>
</body>
</html>



















